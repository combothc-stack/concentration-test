<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Concentration Test Prank</title>

  <style>
    html, body{
      margin:0; padding:0; width:100%; height:100%;
      overflow:hidden;
      background:#000;
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
      color:#fff;
    }

    #screen{
      position:relative;
      width:100vw; height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:24px;
      box-sizing:border-box;
      background:#000;
    }

    #title{
      margin-top:10px;
      font-size:24px;
      font-weight:800;
      text-align:center;
    }

    #instruction{
      margin-top:14px;
      text-align:center;
      color:#ccc;
      font-size:16px;
      line-height:1.35;
      max-width: 520px;
    }

    /* mal√Ω terƒç√≠k (kruh + k≈ô√≠≈æ) */
    #smallTarget{
      width:50px;
      height:50px;
      margin-top:240px; /* dolad√≠≈° si s√°m */
      border-radius:50%;
      border:2px solid rgba(255,255,255,0.95);
      position:relative;
      display:none; /* zobraz√≠ se a≈æ p≈ôi startu testu */
      box-sizing:border-box;
    }
    #smallTarget::before, #smallTarget::after{
      content:"";
      position:absolute;
      left:50%;
      top:50%;
      transform:translate(-50%,-50%);
      background:#fff;
    }
    #smallTarget::before{ width:2px; height:100%; }
    #smallTarget::after{ width:100%; height:2px; }

    /* spacer */
    #spacer{ flex:1; }

    #status{
      color:#aaa;
      font-size:14px;
      margin-bottom:16px;
      text-align:center;
      min-height: 18px;
    }

    /* velk√Ω terƒç (dr≈æ prst / my≈°) */
    #holdTarget{
      width:90px; height:90px;
      border-radius:50%;
      border:2px solid rgba(255,255,255,0.9);
      background: radial-gradient(circle at center, rgba(255,255,255,0.12), rgba(255,255,255,0.02));
      box-sizing:border-box;
      touch-action:none;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:18px;
      color:#fff;
      margin-bottom:24px;
    }

    #holdTarget.pressed{
      transform: scale(0.98);
      opacity:0.9;
    }

    /* overlay s p≈ô√≠≈°erou */
    #scareOverlay{
      position:fixed;
      inset:0;
      background:#000;
      display:none;
      z-index:999;
    }
    #scareOverlay.show{
      display:block;
    }
    #scareOverlay img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    #resultText{
      position:fixed;
      left:50%;
      bottom:20px;
      transform:translateX(-50%);
      font-weight:800;
      font-size:18px;
      text-shadow:0 0 10px #000;
      z-index:1000;
      display:none;
    }

    #btnRestart{
      position:fixed;
      left:50%;
      bottom:60px;
      transform:translateX(-50%);
      padding:12px 18px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.25);
      background: rgba(0,0,0,0.55);
      color:#fff;
      font-weight:700;
      display:none;
      z-index:1001;
      cursor:pointer;
    }
  </style>
</head>

<body>
  <div id="screen">
    <div id="title">Test soust≈ôedƒõn√≠ #1</div>

    <div id="instruction">
      Stiskni a dr≈æ tlaƒç√≠tko a sleduj terƒç√≠k na displeji.<br>
      Nemrkej, dokud test neskonƒç√≠!!
    </div>

    <div id="smallTarget" aria-label="terƒç√≠k"></div>

    <div id="spacer"></div>

    <div id="status">Stiskni a dr≈æ pro spu≈°tƒõn√≠ testu.</div>

    <div id="holdTarget">DR≈Ω</div>
  </div>

  <div id="scareOverlay">
    <img src="monster.png" alt="BOO!" />
  </div>

  <div id="resultText"></div>
  <button id="btnRestart">Restart</button>

  <audio id="scream" src="scream.mp3" preload="auto"></audio>

  <script>
    const holdTarget  = document.getElementById('holdTarget');
    const smallTarget = document.getElementById('smallTarget');
    const statusEl    = document.getElementById('status');
    const overlay     = document.getElementById('scareOverlay');
    const scream      = document.getElementById('scream');
    const resultText  = document.getElementById('resultText');
    const btnRestart  = document.getElementById('btnRestart');

    let testRunning = false;
    let startedAt = null;
    let scareTimer = null;
    let hideTimer = null;

    // nastaven√≠ (podle tv√Ωch √∫prav)
    const SHOCK_MIN_MS = 10000;     // 10s
    const SHOCK_SPAN_MS = 5000;     // +0..5s => 10‚Äì15s
    const AUDIO_SILENCE_MS = 10;   // posun podle ticha ve zvuku
    const VIBRATE_MS = 90;          // vibrace "kopanec"
    const SHOW_DURATION_MS = 4000;  // jak dlouho z≈Østane p≈ô√≠≈°era

    function randDelay(){
      return SHOCK_MIN_MS + Math.floor(Math.random() * (SHOCK_SPAN_MS + 1));
    }

    function resetToTest(){
      testRunning = false;
      startedAt = null;

      if (scareTimer) { clearTimeout(scareTimer); scareTimer = null; }
      if (hideTimer) { clearTimeout(hideTimer); hideTimer = null; }

      overlay.classList.remove('show');
      resultText.style.display = 'none';
      btnRestart.style.display = 'none';

      smallTarget.style.display = 'none';
      statusEl.textContent = 'Stiskni a dr≈æ pro spu≈°tƒõn√≠ testu.';
      holdTarget.classList.remove('pressed');

      // stop zvuk
      try {
        scream.pause();
        scream.currentTime = 0;
      } catch(e){}
    }

    function startTest(){
      if (testRunning) return;

      testRunning = true;
      startedAt = performance.now();

      statusEl.textContent = 'Test bƒõ≈æ√≠‚Ä¶ sleduj terƒç√≠k a nemrkej!';
      smallTarget.style.display = 'block';

      scareTimer = setTimeout(triggerScare, randDelay());
    }

    function cancelTest(){
      if (!testRunning) return;

      testRunning = false;

      if (scareTimer) { clearTimeout(scareTimer); scareTimer = null; }

      smallTarget.style.display = 'none';
      statusEl.textContent = 'Prst jsi zvedl p≈ô√≠li≈° brzy. Zkus to znovu.';

      // stop zvuk pro jistotu
      try {
        scream.pause();
        scream.currentTime = 0;
      } catch(e){}
    }

    function vibrate(ms){
      if (!('vibrate' in navigator)) return;
      try { navigator.vibrate(ms); } catch(e){}
    }

    function triggerScare(){
      if (!testRunning) return;
      testRunning = false;

      const now = performance.now();
      const sec = startedAt ? (now - startedAt) / 1000 : 0;

      // 1) zvuk spustit hned (obsahuje ticho)
      try {
        scream.currentTime = 0;
        scream.play();
      } catch (e) {
        console.warn('Zvuk se nepoda≈ôilo spustit:', e);
      }

      // 2) po AUDIO_SILENCE_MS uk√°zat p≈ô√≠≈°eru + vibrace (zaƒç√°tek v√Ωk≈ôiku)
      setTimeout(() => {
        vibrate(VIBRATE_MS);
        overlay.classList.add('show');
      }, AUDIO_SILENCE_MS);

      resultText.textContent = `Soust≈ôedil ses ${sec.toFixed(1)} s‚Ä¶ üòà`;
      resultText.style.display = 'block';
      btnRestart.style.display = 'block';

      // 3) po SHOW_DURATION_MS n√°vrat
      hideTimer = setTimeout(() => {
        overlay.classList.remove('show');
        statusEl.textContent = 'Test restartov√°n. Stiskni a dr≈æ pro spu≈°tƒõn√≠ testu.';
        smallTarget.style.display = 'none';
      }, SHOW_DURATION_MS);
    }

    // Ovl√°d√°n√≠ ‚Äì my≈° i dotyk
    function onPressStart(e){
      e.preventDefault();
      holdTarget.classList.add('pressed');
      startTest();
    }

    function onPressEnd(e){
      e.preventDefault();
      holdTarget.classList.remove('pressed');
      // kdy≈æ u≈æ bƒõ≈æ√≠ ≈°ok, necanceluj (tady u≈æ testRunning = false)
      if (testRunning) cancelTest();
    }

    holdTarget.addEventListener('mousedown', onPressStart);
    window.addEventListener('mouseup', onPressEnd);

    holdTarget.addEventListener('touchstart', onPressStart, {passive:false});
    window.addEventListener('touchend', onPressEnd, {passive:false});
    window.addEventListener('touchcancel', onPressEnd, {passive:false});

    btnRestart.addEventListener('click', resetToTest);

    resetToTest();
  </script>
</body>
</html>
